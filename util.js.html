<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Dig Dug docs: Source: util.js</title>
	<link rel="stylesheet" href="styles/catalyst.css">
</head>
<body>
	<h1 class="mainHeader"><a href="index.html" class="projectName">
		
			<img src="logo.png" class="projectLogo"
				alt="Dig Dug" title="Dig Dug">
		
	</a></h1>
	
<nav class="mainMenu">
	
		<div class="modulesContainer">
			<h2 class="subsection-title modules">Modules</h2>
			<ul class="modules">
				
<li data-member-id="module:digdug/BrowserStackTunnel" class="">
	<a href="module-digdug_BrowserStackTunnel.html">digdug/BrowserStackTunnel</a>
</li>

<li data-member-id="module:digdug/CrossBrowserTestingTunnel" class="">
	<a href="module-digdug_CrossBrowserTestingTunnel.html">digdug/CrossBrowserTestingTunnel</a>
</li>

<li data-member-id="module:digdug/NullTunnel" class="">
	<a href="module-digdug_NullTunnel.html">digdug/NullTunnel</a>
</li>

<li data-member-id="module:digdug/SauceLabsTunnel" class="">
	<a href="module-digdug_SauceLabsTunnel.html">digdug/SauceLabsTunnel</a>
</li>

<li data-member-id="module:digdug/SeleniumTunnel" class="">
	<a href="module-digdug_SeleniumTunnel.html">digdug/SeleniumTunnel</a>
</li>

<li data-member-id="module:digdug/TestingBotTunnel" class="">
	<a href="module-digdug_TestingBotTunnel.html">digdug/TestingBotTunnel</a>
</li>

<li data-member-id="module:digdug/Tunnel" class="">
	<a href="module-digdug_Tunnel.html">digdug/Tunnel</a>
</li>

				<li><a href="global.html">Globals</a></li>
			</ul>
		</div>
	
</nav>
<div class="persistentTitle hidden"><a href="#overview">util.js</a></div><main class="mainContent doc-source"><h1 class="title header">util.js</h1>
<pre class="prettyprint source linenums"><code>var Decompress = require('decompress');
var Promise = require('dojo/Promise');
var fs = require('fs');
var path = require('path');

module.exports = {
	/**
	 * Adds properties from source objects to a target object using ES5 `Object.defineProperty` instead of
	 * `[[Set]]`. This is necessary when copying properties that are ES5 accessor/mutators.
	 *
	 * @param {Object} target The object to which properties are added.
	 * @param {...Object} source The source object from which properties are taken.
	 * @returns {Object} The target object.
	 */
	mixin: function (target) {
		for (var i = 1, j = arguments.length; i &lt; j; ++i) {
			var source = arguments[i];
			for (var key in source) {
				if (hasOwnProperty.call(source, key)) {
					Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
				}
			}
		}

		return target;
	},

	/**
	 * Attaches an event to a Node.js EventEmitter and returns a handle for removing the listener later.
	 *
	 * @param {EventEmitter} emitter A Node.js EventEmitter object.
	 * @param {string} event The name of the event to listen for.
	 * @param {Function} listener The event listener that will be invoked when the event occurs.
	 * @returns {{ remove: Function }} A remove handle.
	 */
	on: function (emitter, event, listener) {
		emitter.on(event, listener);
		return {
			remove: function () {
				this.remove = function () {};
				emitter.removeListener(event, listener);
			}
		};
	},

	/**
	 * Returns true if a file or directory exists
	 *
	 * @param {string} filename
	 * @returns {bool} true if filename exists, false otherwise
	 */
	fileExists: function (filename) {
		try {
			fs.statSync(filename);
			return true;
		}
		catch (error) {
			return false;
		}
	},

	/**
	 * Decompresses archive data into a given directory
	 *
	 * @param {Buffer} data 
	 * @param {string} directory
	 * @returns {Promise.&lt;void>} A Promise that resolves when the data is decompressed
	 */
	decompress: function (data, directory) {
		return new Promise(function (resolve, reject) {
			var decompressor = new Decompress()
				.src(data)
				.dest(directory)
				.use(Decompress.zip())
				.use(Decompress.targz());
			decompressor.run(function (error, files) {
				if (error) {
					reject(error);
				}
				else {
					resolve(files);
				}
			});
		});
	},

	/**
	 * Writes data to a file.
	 *
	 * The file's parent directories will be created if they do not already exist.
	 *
	 * @param {Buffer} data 
	 * @param {string} filename
	 * @returns {Promise.&lt;void>} A Promise that resolves when the file has been written
	 */
	writeFile: function (data, filename) {
		return new Promise(function (resolve, reject) {
			function mkdirp(dir) {
				if (!dir) {
					return;
				}

				try {
					fs.mkdirSync(dir);
				}
				catch (error) {
					// A parent directory didn't exist, create it
					if (error.code === 'ENOENT') {
						mkdirp(path.dirname(dir));
						mkdirp(dir);
					}
					else {
						if (!fs.statSync(dir).isDirectory()) {
							throw error;
						}
					}
				}
			}

			mkdirp(path.dirname(filename));
			fs.writeFile(filename, data, function (error) {
				if (error) {
					reject(error);
				}
				else {
					resolve();
				}
			});
		});
	}
};
</code></pre>
</main>


	<script src="scripts/prettify/prettify.js"></script>
	<script src="scripts/prettify/lang-css.js"></script>
	<script>prettyPrint();</script>
	<script src="scripts/nav.js"></script>
</body>
</html>
